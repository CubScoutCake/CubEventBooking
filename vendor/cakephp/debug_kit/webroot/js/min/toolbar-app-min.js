function Toolbar(t){this.button=t.button,this.panelButtons=t.panelButtons,this.content=t.content,this.panelClose=t.panelClose,this.keyboardScope=t.keyboardScope,this.currentRequest=t.currentRequest,this.originalRequest=t.originalRequest,this.baseUrl=t.baseUrl}Toolbar.prototype={_currentPanel:null,_lastPanel:null,_state:0,currentRequest:null,originalRequest:null,ajaxRequests:[],states:["collapse","toolbar"],toggle:function(){var t=this.nextState();this.updateButtons(t),this.updateToolbarState(t),window.parent.postMessage(t,window.location.origin)},state:function(){return this.states[this._state]},nextState:function(){return this._state++,this._state==this.states.length&&(this._state=0),this.saveState(),this.state()},saveState:function(){window.localStorage&&window.localStorage.setItem("toolbar_state",this._state)},loadState:function(){if(window.localStorage){var t=window.localStorage.getItem("toolbar_state");return t||(t=0),0==t?this.hideContent():1==t?this.toggle():void 0}},updateToolbarState:function(t){"toolbar"===t&&this.button.addClass("open"),"collapse"===t&&this.button.removeClass("open")},updateButtons:function(t){"toolbar"===t&&this.panelButtons.show(),"collapse"===t&&this.panelButtons.hide()},isExpanded:function(){return this.content.hasClass("enabled")},hideContent:function(){this.content.removeClass("enabled"),this.currentPanelButton().removeClass("panel-active");var t=this;setTimeout(function(){t._currentPanel=null,window.parent.postMessage(t.state(),window.location.origin)},250)},loadPanel:function(t){var e=baseUrl+"debug_kit/panels/view/"+t,n=this.content.find("#panel-content"),a=this,o,i=$("#loader");this._lastPanel!=t&&(o=setTimeout(function(){i.addClass("loading")},500)),this._currentPanel=t,this._lastPanel=t,window.parent.postMessage("expand",window.location.origin),$.get(e,function(t){clearTimeout(o),i.removeClass("loading"),a.content.addClass("enabled"),n.html(t),a.bindNeatArray()})},bindNeatArray:function(){var t=this.content.find(".neat-array-sort"),e=this;t.click(function(){$(this).attr("checked")?document.cookie="debugKit_sort=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path="+e.baseUrl:document.cookie="debugKit_sort=1; path="+e.baseUrl,e.loadPanel(e.currentPanel())});var n=this.content.find(".depth-0");n.find("ul").hide().parent().addClass("expandable collapsed"),n.on("click","li",function(t){t.stopPropagation();var e=$(this);e.children("ul").toggle(),e.toggleClass("expanded").toggleClass("collapsed")})},currentPanel:function(){return this._currentPanel},currentPanelButton:function(){return this.button.find("[data-id='"+this.currentPanel()+"']")},keyboardListener:function(){var t=this;this.keyboardScope.keydown(function(e){if(27===e.keyCode){if(t.isExpanded())return t.hideContent();if("toolbar"===t.state())return t.toggle()}if(37===e.keyCode&&t.isExpanded()){t.panelButtons.removeClass("panel-active");var n=t.currentPanelButton().prev();if(n.hasClass("panel"))return n.addClass("panel-active"),t.loadPanel(n.data("id"))}if(39===e.keyCode&&t.isExpanded()){t.panelButtons.removeClass("panel-active");var a=t.currentPanelButton().next();if(a.hasClass("panel"))return a.addClass("panel-active"),t.loadPanel(a.data("id"))}})},mouseListener:function(){var t=this;this.panelButtons.on("click",function(e){t.panelButtons.removeClass("panel-active"),e.preventDefault(),e.stopPropagation();var n=$(this).attr("data-id"),a=t.currentPanel()===n;return t.isExpanded()&&a&&t.hideContent(),a?!1:($(this).addClass("panel-active"),void t.loadPanel(n))}),this.button.on("click",function(e){t.toggle()}),toolbar.panelClose.on("click",function(e){return t.hideContent(),!1})},windowOrigin:function(){window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""))},onMessage:function(t){0===t.data.indexOf("ajax-completed$$")&&this.onRequest(JSON.parse(t.data.split("$$")[1]))},onRequest:function(t){this.ajaxRequests.push(t),$(".panel-summary:contains(xhr)").text(""+this.ajaxRequests.length+" xhr")},initialize:function(){this.windowOrigin(),this.mouseListener(),this.keyboardListener(),this.loadState();var t=this;window.addEventListener("message",function(e){t.onMessage(e)},!1)}};